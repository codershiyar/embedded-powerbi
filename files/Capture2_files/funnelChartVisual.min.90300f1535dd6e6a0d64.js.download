"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['funnelChartVisual.min.js'] || (this.parseTimeMarkers['funnelChartVisual.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('funnelChartVisual.min.js');var es6,powerbi,__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();!function(t){var l,s;function e(){}l=t.visuals||(t.visuals={}),s=jsCommon.BrowserUtils,e.prototype.bindEvents=function(t,e,a){var i=this.bars=t.bars,r=t.interactors,n=t.clearCatcher,o=t.root;this.hasHighlights=t.hasHighlights,l.InteractivityUtils.registerStandardInteractivityHandlers(i,e),l.InteractivityUtils.registerStandardInteractivityHandlers(r,e),l.InteractivityUtils.registerClearCatcherShortcut(o,e),a&&(t=a.dataPointNavigationManager,i=a.pointSourceKey,t.isEmpty(i)||(l.InteractivityUtils.registerEnterPlotAreaHandler(o,t,i),l.InteractivityUtils.registerDataPointNavigationHandler(o,t,i))),n.on("click",function(){s.isCtrlOrMeta(d3.event)||e.handleClearSelection()})},e.prototype.renderSelection=function(e){var a=this.hasHighlights;this.bars.attr("aria-selected",function(t){return t.selected}).style("fill-opacity",function(t){return l.ColumnUtil.getFillOpacity(t.selected,t.highlight,e,a)}).style("stroke-opacity",function(t){return l.ColumnUtil.getFillOpacity(t.selected,t.highlight,e,a)})},e.prototype.renderFocus=function(t){t&&s.focus(t)},l.FunnelWebBehavior=e}(powerbi=powerbi||{}),function(it){var rt,i,t,l;function nt(t){this.labelPositionObjects=[rt.labelPosition.outsideEnd,rt.labelPosition.insideCenter],t&&(this.tooltipsEnabled=t.tooltipsEnabled,t.funnelSmallViewPortProperties&&(this.funnelSmallViewPortProperties=t.funnelSmallViewPortProperties),t.animator&&(this.animator=t.animator),t.behavior)&&(this.behavior=t.behavior)}rt=it.visuals||(it.visuals={}),i=it.visuals.builder,t=jsCommon.CssConstants.createClassAndSelector,l=jsCommon.BrowserUtils,nt.converter=function(t,e,A,a){void 0===a&&(a=!0);for(var i=rt.funnelChartProps.general.formatString,r=it.data.createDataViewCategoricalReaderAdvanced(t,{staticSeriesRoleNames:["Y"],colorOptions:{valueRole:"Y",visualStyle:e},formatStringProp:i}),n=r.data,o=r.columns,l=[],s=t.categorical,c=n.hasHighlights(),N=[],u=0,U=n.getSeriesCount();u<U;u++)N.push(o.getValueMetadataColumn("Y",u));var h,g,d,p,f,G=!1,m=!1,y=[],b=this.getDefaultLabelSettings(e),j=this.getDefaultPercentLabelSettings(e),R=this.getDefaultCategoryLabelSettings(e),E=rt.GradientUtils.getGradientValueColumn(s),s=!1;if(t&&t.metadata&&t.metadata.objects&&((f=t.metadata.objects.labels)&&rt.DataLabelViewModel.updateLabelSettingsFromLabelsObject(f,b,void 0,e),(f=t.metadata.objects.percentBarLabel)&&rt.DataLabelViewModel.updateLabelSettingsFromLabelsObject(f,j,void 0,e),f=t.metadata.objects.categoryAxis)&&rt.DataLabelViewModel.updateLabelSettingsFromLabelsObject(f,R,void 0,e),!n.hasValues("Y"))return{allValuesAreNegative:!1,canShowDataLabels:!0,categoryAxisSettings:R,categoryCount:0,categoryLabels:y,dataLabelsSettings:b,dataPoints:l,hasCategories:s,hasHighlights:c,hasNegativeValues:m,highlightsOverflow:G,percentBarLabelSettings:j,valuesMetadata:N};h=n.getValue("Y",0,0),c&&(g=n.getHighlight("Y",0,0));var z=rt.valueFormatter.getLocalizedString("Percentage"),v=b.fontProperties.color;if(n.hasCategories())for(var s=!0,S=0,W=n.getCategoryCount();S<W;S++){var L=o.getCategoryColumn("Category"),C=n.getCategoryValue("Category",S),P=o.getValueMetadataColumn("Y"),x=rt.SelectionIdBuilder.builder().withCategory([L],S,null==(V=null==L?void 0:L.source)?void 0:V.queryName,!0).withMeasure(P.queryName,o.getValueColumn("Y"),S).createSelectionId(),w=n.getValue("Y",S),F=n.getFormatString("Y",S),V=rt.converterHelper.formatFromMetadataColumn(C,L.source,i),D=void 0,B=void 0,T=void 0,M=void 0,O=(B=c?(T=n.getHighlight("Y",S),M=n.getHighlightFormatString("Y",S),D=g?T/g:null,p?T/p:null):(D=h?w/h:null,d?w/d:null),void 0),H=(a&&((O=[]).push({displayName:L.source.displayName,value:V}),null!=w&&O.push({displayName:P.displayName,value:rt.converterHelper.formatFromMetadataColumn(w,P,i,!1,F)}),null!=T&&O.push({displayName:rt.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:rt.converterHelper.formatFromMetadataColumn(T,P,i,!1,M)}),(C=E?E.source:void 0)&&C!==P&&null!=E.values[S]&&O.push({displayName:C.displayName,value:rt.converterHelper.formatFromMetadataColumn(n.getValue("Gradient",S),C,i,!1,n.getFormatString("Gradient",S))}),nt.addFunnelPercentsToTooltip(z,O,A,D,B,c),rt.TooltipBuilder.addTooltipMeasures(r,O,S,void 0,i)),rt.DataLabelUtil.determineDataLabelFillColor({defaultColor:v,categoricalDataReader:r,categoryIndex:S})),Y=rt.DataLabelUtil.isAssignedColor(H)?H.color:v,K=(b.fontProperties=rt.DataLabelUtil.updateFontPropertiesColor(Y,b.fontProperties),r.colors.createBySeries(0,S));l.push({label:V,value:w,formatString:F,originalValue:w,percentOfFirst:D,percentOfPrevious:B,categoryIndex:S,seriesIndex:null,identity:x,selected:!1,key:x.getKey(),tooltipInfo:O,formattedTooltip:rt.tooltipUtils.formatTooltipInfo(O),color:K,labelFill:H.color}),c&&(k=rt.SelectionId.createWithHighlight(x),L=n.getHighlight("Y",S),C=n.getHighlightFormatString("Y",S),l.push({label:V,value:w,formatString:F,originalValue:w,percentOfFirst:D,percentOfPrevious:B,categoryIndex:S,seriesIndex:null,identity:k,selected:!1,key:k.getKey(),highlight:!0,highlightValue:L,highlightFormatString:C,originalHighlightValue:L,tooltipInfo:O,formattedTooltip:rt.tooltipUtils.formatTooltipInfo(O),color:K}),p=L),d=w}else{s=!1;for(S=0,u=0,U=n.getSeriesCount();u<U;u++){var k,q,J,w=n.getValue("Y",S,u),F=n.getFormatString("Y",S,u),P=o.getValueMetadataColumn("Y",u),x=rt.SelectionId.createWithMeasure(P.queryName),K=r.colors.createByValue(u),H=rt.DataLabelUtil.determineDataLabelFillColor({seriesColor:null==b?void 0:b.fontProperties.color,defaultColor:v,categoricalDataReader:r,categoryIndex:S,seriesIndex:u}),Y=rt.DataLabelUtil.isAssignedColor(H)?H.color:v,D=(b.fontProperties=rt.DataLabelUtil.updateFontPropertiesColor(Y,b.fontProperties),void 0),B=void 0,T=void 0,M=void 0,O=(B=c?(T=n.getHighlight("Y",S,u),M=n.getHighlightFormatString("Y",S,u),D=g?T/g:null,p?T/p:null):(D=h?w/h:null,d?w/d:null),void 0);a&&(O=[],null!=w&&O.push({displayName:P.displayName,value:rt.converterHelper.formatFromMetadataColumn(w,P,i,!1,F)}),null!=T&&O.push({displayName:rt.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:rt.converterHelper.formatFromMetadataColumn(T,P,i,!1,M)}),nt.addFunnelPercentsToTooltip(z,O,A,D,B,c),rt.TooltipBuilder.addTooltipMeasures(r,O,S,void 0,i)),l.push({label:P.displayName,value:w,formatString:F,originalValue:w,percentOfFirst:D,percentOfPrevious:B,categoryIndex:u,seriesIndex:null,identity:x,selected:!1,key:x.getKey(),tooltipInfo:O,formattedTooltip:rt.tooltipUtils.formatTooltipInfo(O),color:K,labelFill:H.color}),c&&(k=rt.SelectionId.createWithHighlight(x),q=n.getHighlight("Y",S,u),J=n.getHighlightFormatString("Y",S,u),l.push({label:P.displayName,value:w,formatString:F,originalValue:w,percentOfFirst:D,percentOfPrevious:B,categoryIndex:u,seriesIndex:null,identity:k,key:k.getKey(),selected:!1,highlight:!0,originalHighlightValue:q,highlightValue:q,highlightFormatString:J,tooltipInfo:O,formattedTooltip:rt.tooltipUtils.formatTooltipInfo(O),color:K}),p=q),d=w}}for(var Q=0;Q<l.length;Q+=c?2:1){var I=l[Q];y.push(I.label)}for(var X,Z=0<l.length&&_.every(l,function(t){return(!t.highlight||t.highlightValue<=0)&&t.value<0}),$=0,tt=l;$<tt.length;$++){var et,at,I=tt[$];Z?(I.value=Math.abs(I.value),I.highlight&&(I.highlightValue=Math.abs(I.highlightValue))):((et=(w=I.value)<0)&&(I.value=0),at=!1,I.highlight&&(at=(T=I.highlightValue)<0,I.highlightValue=at?0:T),m=m||et||at),it.Double.greaterWithPrecision(I.highlightValue,I.value)&&(G=!0)}return e.isHighContrast&&(X={visible:!0,color:rt.ColorHelper.getThemeColor(e,rt.ForegroundColorName),width:rt.CartesianHelper.defaultLineStrokeWidth}),{allValuesAreNegative:Z,canShowDataLabels:!0,categoryAxisSettings:R,categoryCount:y.length,categoryLabels:y,dataLabelsSettings:b,dataPoints:l,hasCategories:s,hasHighlights:c,hasNegativeValues:m,highlightsOverflow:G,percentBarLabelSettings:j,strokeSettings:X,valuesMetadata:N}},nt.prototype.getFormattingModel=function(){var t=this;return new rt.builder.FormattingModelBuilder(function(){return t.getColorsCard()},function(){return t.getDataLabelsCard()},function(){return t.getCategoryLabelsCard()},function(){return t.getConversionRateLabelsCard()}).build()},nt.prototype.getColorsCard=function(){var t,e=this.data;if(e&&this.dataViews&&this.dataViews.length)return t=(t=_.first(this.dataViews))&&t.categorical,rt.GradientUtils.hasGradientRole(t)?void 0:it.colorEnumerationHelperModuleFactory().getCategoryDataColorsFormattingModel({dataView:this.dataViews[0],categories:_.map(e.dataPoints,function(t){return{color:t.color,displayName:t.label,identity:t.identity}}),style:this.style,fillInstanceKind:3},this.featureSwitches,this.hostServices)},nt.prototype.getDataLabelsCard=function(){var e=this,t=nt.getLabelSettingsOptions(void 0,this.data.dataLabelsSettings,!0,this.style,this.labelPositionObjects),a=(t.funnelLabelStyle=!0,t.dataLabelsSettings),a=(a.position&&this.labelPositionObjects.indexOf(a.position)<0&&(a.position=rt.labelPosition.outsideEnd),rt.DataLabelViewModel.getDefaultDataLabelsProps("labels"));a.labelStyle=rt.funnelChartObjectProps.labels.funnelLabelStyle;a={cardBuilder:new i.FormattingCardBuilder(new i.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",a,function(t){return e.hostServices.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:t,instanceKind:this.data.hasCategories?void 0:3,individualSelector:rt.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:this.data.hasCategories,hasDynamicSeries:!1,hasSeriesSelector:!1})};return rt.DataLabelViewModel.getDataLabelsFormattingModel(a)},nt.prototype.getCategoryLabelsCard=function(){var e=this,t=nt.getLabelSettingsOptions(void 0,this.data.categoryAxisSettings,!0,this.style,void 0),a={color:rt.funnelChartObjectProps.categoryAxis.color,fontFamily:rt.funnelChartObjectProps.categoryAxis.fontFamily,fontSize:rt.funnelChartObjectProps.categoryAxis.fontSize,show:rt.funnelChartObjectProps.categoryAxis.show,bold:rt.funnelChartObjectProps.categoryAxis.bold,italic:rt.funnelChartObjectProps.categoryAxis.italic,underline:rt.funnelChartObjectProps.categoryAxis.underline},a={cardBuilder:new i.FormattingCardBuilder(new i.FormattingCardUidBuilder("categoryAxis"),"Visual_CategoryLabels",a,function(t){return e.hostServices.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:t,customDescription:"Visual_CategoryLabelOptionsDescription",instanceKind:3};return rt.DataLabelViewModel.getDataLabelsFormattingModel(a)},nt.prototype.getConversionRateLabelsCard=function(){var e=this,t=nt.getLabelSettingsOptions(void 0,this.data.percentBarLabelSettings,!1,this.style,void 0),a={color:rt.funnelChartObjectProps.percentBarLabel.color,fontFamily:rt.funnelChartObjectProps.percentBarLabel.fontFamily,fontSize:rt.funnelChartObjectProps.percentBarLabel.fontSize,show:rt.funnelChartObjectProps.percentBarLabel.show,bold:rt.funnelChartObjectProps.percentBarLabel.bold,italic:rt.funnelChartObjectProps.percentBarLabel.italic,underline:rt.funnelChartObjectProps.percentBarLabel.underline},a={cardBuilder:new i.FormattingCardBuilder(new i.FormattingCardUidBuilder("percentBarLabel"),"Visual_PercentBarLabel",a,function(t){return e.hostServices.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:t,customDescription:"Visual_PercentBarLabelDescription",instanceKind:3};return rt.DataLabelViewModel.getDataLabelsFormattingModel(a)},nt.prototype.enumerateObjectInstances=function(t){var e=new rt.ObjectEnumerationBuilder;switch(t.objectName){case"dataPoint":var a=this.dataViews&&0<this.dataViews.length&&this.dataViews[0]&&this.dataViews[0].categorical;rt.GradientUtils.hasGradientRole(a)||this.enumerateDataPoints(e);break;case"labels":a=nt.getLabelSettingsOptions(e,this.data.dataLabelsSettings,!0,this.style,this.labelPositionObjects);a.funnelLabelStyle=!0,rt.DataLabelViewModel.enumerateDataLabels(a,this.featureSwitches,void 0,{objectName:"labels"});break;case"percentBarLabel":a=nt.getLabelSettingsOptions(e,this.data.percentBarLabelSettings,!1,this.style,void 0);rt.DataLabelViewModel.enumerateDataLabels(a,this.featureSwitches,void 0,{objectName:"percentBarLabel"});break;case"categoryAxis":a=nt.getLabelSettingsOptions(e,this.data.categoryAxisSettings,!0,this.style,void 0);rt.DataLabelViewModel.enumerateDataLabels(a,this.featureSwitches,void 0,{objectName:"categoryAxis"})}return e.complete()},nt.getLabelSettingsOptions=function(t,e,a,i,r){return{enumeration:t,dataLabelsSettings:e,show:!0,displayUnits:a,precision:a,percentagePrecision:a,position:a,positionObject:r,fontSize:!0,fontFamily:!0,style:i,bold:!0,italic:!0,underline:!0}},nt.prototype.enumerateDataPoints=function(t){var e=this.data;e&&this.dataViews&&this.dataViews.length&&it.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:t,dataView:this.dataViews[0],categories:_.map(e.dataPoints,function(t){return{color:t.color,displayName:t.label,identity:t.identity}}),style:this.style,fillInstanceKind:3},this.featureSwitches)},nt.prototype.init=function(t){this.options=t,this.featureSwitches=t.featureSwitches;var e=t.element,e=this.svg=d3.select(e.get(0)).append("svg").classed(nt.VisualClassName,!0);this.tooltipService=rt.createTooltipService(t.host),this.behavior&&(this.clearCatcher=rt.appendClearCatcher(this.svg)),this.currentViewport=t.viewport,this.margin=it.Prototype.inherit(nt.DefaultMargin),this.style=t.style,this.hostServices=t.host,this.behavior&&(this.interactivityService=rt.createInteractivityService(this.hostServices),t=l.isInternetExplorerOrEdge(),this.svg.attr("tabindex",0).attr("focusable",!0).attr("role","listbox").attr("aria-multiselectable",!0).attr("aria-label",this.hostServices.getLocalizedString("Visual_Plot")).classed(rt.SetFocusRingClassName,!t)),this.percentGraphicsContext=e.append("g").classed(nt.Selectors.percentBar.root.class,!0),this.funnelGraphicsContext=e.append("g"),this.axisGraphicsContext=e.append("g"),this.labelGraphicsContext=e.append("g").classed(rt.DataLabelViewModel.labelGraphicsContextClass.class,!0),this.updateViewportProperties()},nt.prototype.updateViewportProperties=function(){var t=this.currentViewport;this.svg.attr("width",t.width).attr("height",t.height)},nt.prototype.update=function(t){this.data={dataPoints:[],categoryLabels:[],valuesMetadata:[],hasHighlights:!1,highlightsOverflow:!1,canShowDataLabels:!0,dataLabelsSettings:nt.getDefaultLabelSettings(this.style),hasNegativeValues:!1,allValuesAreNegative:!1,percentBarLabelSettings:nt.getDefaultPercentLabelSettings(this.style),categoryAxisSettings:nt.getDefaultCategoryLabelSettings(this.style),categoryCount:0,hasCategories:!1};var e,a=this.dataViews=t.dataViews;this.currentViewport=t.viewport,a&&0<a.length&&((e=a[0]).categorical&&(this.data=nt.converter(e,this.style,this.hostServices,this.tooltipsEnabled),this.interactivityService)&&this.interactivityService.applySelectionStateToData(this.data.dataPoints),e=rt.getInvalidValueWarnings(a,!1,!1,!1,["Tooltips"]),this.data.allValuesAreNegative?e.push(new rt.AllNegativeValuesWarning):this.data.hasNegativeValues&&e.push(new rt.NegativeValuesNotSupportedWarning),this.hostServices.setWarnings(e)),this.updateViewportProperties(),this.updateInternal(t.suppressAnimations)},nt.prototype.onDataChanged=function(t){this.update({dataViews:t.dataViews,suppressAnimations:t.suppressAnimations,viewport:this.currentViewport})},nt.prototype.onResizing=function(t){this.currentViewport=t,this.update({dataViews:this.dataViews,suppressAnimations:!0,viewport:this.currentViewport})},nt.prototype.getMaxLabelLength=function(t,e){for(var a=0,i=it.TextMeasurementService.measureSvgTextWidth,r=0,n=t.length;r<n;r++)e.text=t[r],a=Math.max(a,i(e));return a+nt.LabelFunnelPadding},nt.prototype.updateInternal=function(t){var e,a,i,r,n,o,l,s,c,u,h;null!=this.data&&(u=(a=(e=this.data).dataPoints).filter(function(t){return!t.highlight}),i=this.isHidingPercentBars(),s=(r=this.setUpAxis()).margin,n=this.funnelGraphicsContext.attr("transform",rt.SVGUtil.translate(s.left,s.top)),o=this.labelGraphicsContext.attr("transform",rt.SVGUtil.translate(s.left,s.top)),this.percentGraphicsContext.attr("transform",rt.SVGUtil.translate(s.left,s.top)),this.svg.style("font-family",rt.DataLabelViewModel.StandardFontFamily),l=nt.getLayout(e,r),s=this.getLabels(l,s),this.animator&&!t&&(u={viewModel:e,interactivityService:this.interactivityService,layout:l,axisGraphicsContext:this.axisGraphicsContext,shapeGraphicsContext:n,percentGraphicsContext:this.percentGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,axisOptions:r,dataPointsWithoutHighlights:u,labelLayout:s,isHidingPercentBars:i,visualInitOptions:this.options},c=(h=this.animator.animate(u)).shapes),this.animator&&!t&&!h.failed||(nt.drawDefaultAxis(this.axisGraphicsContext,r,i),c=nt.drawDefaultShapes(e,a,n,l,this.interactivityService),nt.drawPercentBars(e,this.percentGraphicsContext,l,i,this.style),rt.DataLabelRenderer.drawDefaultLabels({labelContext:o,dataLabels:s,formatMode:!1,onObject:!1})),this.interactivityService&&(u=nt.drawInteractorShapes(a,n,l),t={root:this.svg,bars:c,interactors:u,clearCatcher:this.clearCatcher,hasHighlights:e.hasHighlights},h={navigationOptions:{helper:this,navigationStrategy:rt.DataPointNavigationStrategy.CategoryOnly},pointSourceKey:"funnel"},this.interactivityService.bind(a,this.behavior,t,h),this.tooltipsEnabled)&&this.tooltipService.addTooltip(u,function(t){return t.data&&t.data.tooltipInfo},function(t){return t.data&&t.data.identity&&[t.data.identity]}),this.tooltipsEnabled)&&this.tooltipService.addTooltip(c,function(t){return t.data&&t.data.tooltipInfo},function(t){return t.data&&t.data.identity&&[t.data.identity]})},nt.prototype.getFirstElement=function(){return{element:this.getHTMLElementFromCategoryIndex(0)}},nt.prototype.getNextDataPoint=function(t,e,a){var i=this.data.categoryCount,r=t;do{switch(a){case rt.DataDirection.NextCategory:i<=(t+=1)&&(t=0);break;case rt.DataDirection.PreviousCategory:--t<0&&(t=i-1);break;case rt.DataDirection.NextSeries:case rt.DataDirection.PreviousSeries:}}while(0===this.data.dataPoints[t].value&&t!==r);return{element:this.getHTMLElementFromCategoryIndex(t)}},nt.prototype.getHTMLElementFromCategoryIndex=function(e){return this.svg.selectAll(nt.Selectors.funnel.bars.selector).filter(function(t){return t.categoryIndex===e}).node()},nt.prototype.getUsableVerticalSpace=function(){var t=this.margin;return this.currentViewport.height-(t.top+t.bottom)-nt.MinBarThickness*this.data.categoryCount},nt.prototype.isHidingPercentBars=function(){var t;return!this.data.percentBarLabelSettings.show||(t=this.getPercentBarTextHeight(),this.getUsableVerticalSpace()-2*nt.MinBarThickness*nt.PercentBarToBarRatio-2*t<=0)},nt.prototype.isSparklines=function(){return this.getUsableVerticalSpace()<=0},nt.prototype.setUpAxis=function(){var t=this.data,e=t.dataPoints,a=t.categoryLabels,i=this.currentViewport,r=it.Prototype.inherit(nt.DefaultMargin),n=this.isSparklines(),o=this.isHidingPercentBars(),l=o?0:this.getPercentBarTextHeight(),s=i.height-(r.top+r.bottom)-2*l,c=nt.MaxMarginFactor,u=t.categoryAxisSettings.fontProperties,c=(0<a.length&&n?t.canShowDataLabels=!(a=[]):this.showCategoryLabels()?(n=rt.FontProperties.toTextProperties(u),n=this.getMaxLabelLength(a,n),c=i.width*c,n=Math.min(n,c),r.left=n+nt.YAxisPadding):a=[],i.width-(r.left+r.right)),n=nt.BarToSpaceRatio,i=d3.max(e.map(function(t){return t.value})),e=(t.hasHighlights&&(e=d3.max(e.map(function(t){return t.highlightValue})),i=d3.max([i,e])),0),h=s,g=o?s-t.categoryCount*nt.MaxBarHeight:s-t.categoryCount*nt.MaxBarHeight-2*nt.MaxBarHeight*nt.PercentBarToBarRatio;return 0<t.categoryCount&&0<g&&(e=Math.ceil(g/2),h=Math.ceil(s-g/2)),o||(e+=l,h+=l),{margin:r,valueScale:d3.scaleLinear().domain([0,i]).range([c,0]),categoryScale:d3.scaleBand().domain(d3.range(0,t.categoryCount)).range([e,h]).paddingInner(n).paddingOuter(o?n:nt.PercentBarToBarRatio),maxScore:i,maxWidth:c,rangeStart:e,rangeEnd:h,barToSpaceRatio:n,categoryLabels:a,labelFontProperties:u}},nt.prototype.getPercentBarTextHeight=function(){var t=rt.FontProperties.toTextProperties(this.data.percentBarLabelSettings.fontProperties);return it.TextMeasurementService.estimateSvgTextHeight(t)},nt.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},nt.prototype.onRestoreSelection=function(t){return!!this.interactivityService&&this.interactivityService.restoreSelection(t.selection)},nt.getLayout=function(t,e){function a(t){return(d-Math.abs(o(t)-o(0)))/2}function i(t){return Math.max(nt.MinimumInteractorSize,Math.abs(o(t)-o(0)))}var r=t.highlightsOverflow,n=e.categoryScale,o=e.valueScale,l=e.maxScore,s=n.bandwidth(),c=Math.ceil(s/2),u=s*nt.OverflowingHighlightWidthRatio,h=u/2,g=t.categoryCount-1,d=Math.abs(o(l)-o(0)),e=rt.FontProperties.toTextProperties(t.percentBarLabelSettings.fontProperties),p=it.TextMeasurementService.estimateSvgTextBaselineDelta(e),f=it.TextMeasurementService.estimateSvgTextHeight(e)-p;return{percentBarLayout:{mainLine:{x2:function(t){return Math.abs(o(t.value)-o(0))},transform:function(t){var e=o(t.value)-a(t.value),t=t.isTop?n(0)-c:n(g)+s+c;return rt.SVGUtil.translate(e,t)}},leftTick:{y2:function(t){return c},transform:function(t){var e=o(t.value)-a(t.value),t=t.isTop?n(0)-c-c/2:n(g)+s+c-c/2;return rt.SVGUtil.translate(e,t)}},rightTick:{y2:function(t){return c},transform:function(t){var e=o(t.value)-a(t.value)+Math.abs(o(t.value)-o(0)),t=t.isTop?n(0)-c-c/2:n(g)+s+c-c/2;return rt.SVGUtil.translate(e,t)}},text:{attr:{x:function(t){return Math.ceil(Math.abs(o(l)-o(0))/2)},y:function(t){return t.isTop?-c/2-p:f+c/2},transform:function(t){t=t.isTop?n(0)-c:n(g)+s+c;return rt.SVGUtil.translate(0,t)}},style:rt.FontProperties.toSVGStyle(t.percentBarLabelSettings.fontProperties),maxWidth:d}},shapeLayout:{height:function(t){return t.highlight&&r?u:s},width:function(t){return Math.abs(o(nt.getValueFromDataPoint(t))-o(0))},y:function(t){return n(t.categoryIndex)+(t.highlight&&r?h:0)},x:function(t){t=nt.getValueFromDataPoint(t);return o(t)-a(t)}},shapeLayoutWithoutHighlights:{height:function(t){return s},width:function(t){return Math.abs(o(t.value)-o(0))},y:function(t){return n(t.categoryIndex)+0},x:function(t){return o(t.value)-a(t.value)}},zeroShapeLayout:{height:function(t){return t.highlight&&r?u:s},width:function(t){return 0},y:function(t){return n(t.categoryIndex)+(t.highlight&&r?h:0)},x:function(t){return o((o.domain()[0]+o.domain()[1])/2)}},interactorLayout:{height:function(t){return t.highlight&&r?u:s},width:function(t){return i(nt.getValueFromDataPoint(t))},y:function(t){return n(t.categoryIndex)+(t.highlight&&r?h:0)},x:function(t){t=i(nt.getValueFromDataPoint(t));return(d-t)/2}}}},nt.drawDefaultAxis=function(t,e,a){var i=d3.range(0,e.categoryLabels.length),a=d3.scaleBand().domain(i).range([e.rangeStart,e.rangeEnd]).paddingInner(e.barToSpaceRatio).paddingOuter(a?e.barToSpaceRatio:nt.PercentBarToBarRatio),a=d3.axisRight(a).tickPadding(nt.TickPadding).tickSizeInner(nt.InnerTickSize).ticks(i.length).tickValues(i).tickFormat(function(t){return e.categoryLabels[t]}),i=(t.attr("class","axis hideLinesOnAxis").attr("transform",rt.SVGUtil.translate(0,e.margin.top)).call(a).select("path").attr("stroke",null),t.selectAll(".tick").call(rt.tooltipUtils.tooltipUpdate,e.categoryLabels),e.margin.left-nt.LabelFunnelPadding);t.selectAll(".tick text").call(rt.AxisHelper.LabelLayoutStrategy.clip,i,it.TextMeasurementService.svgEllipsis).styles(rt.FontProperties.toSVGStyle(e.labelFontProperties))},nt.drawDefaultShapes=function(t,e,a,i,r){t.strokeSettings&&t.strokeSettings.visible&&a.style("stroke",t.strokeSettings.color).style("stroke-width",t.strokeSettings.width);var n=t.hasHighlights,t=l.isInternetExplorerOrEdge(),o=r&&r.hasSelection(),a=a.selectAll(nt.Selectors.funnel.bars.selector).data(e,function(t){return t.key}),e=a.enter().append("rect").attr("role","option").attr("aria-label",function(t){return t.formattedTooltip}).attr("aria-selected",function(t){return t.selected}).attr("class",function(t){return t.highlight?nt.FunnelBarHighlightClass:nt.Selectors.funnel.bars.class}).merge(a);return e.style("fill",function(t){return t.color}).style("fill-opacity",function(t){return rt.ColumnUtil.getFillOpacity(t.selected,t.highlight,o,n)}).attrs(i.shapeLayout),r&&e.attr("tabindex",0).attr("focusable",!0).classed(rt.SetFocusRingClassName,!t),a.exit().remove(),e},nt.getValueFromDataPoint=function(t,e){return(e=void 0===e?!1:e)?t.highlight?t.originalHighlightValue:t.originalValue:t.highlight?t.highlightValue:t.value},nt.getFormatStringFromDataPoint=function(t){return null!=t.highlight?t.highlightFormatString:t.formatString},nt.drawInteractorShapes=function(t,e,a){t=t.filter(function(t){return!t.highlight&&a.interactorLayout.width(t)===nt.MinimumInteractorSize}),e=e.selectAll(nt.Selectors.funnel.interactors.selector).data(t,function(t){return t.key}),t=e.enter().append("rect").attr("class",nt.Selectors.funnel.interactors.class).merge(e);return t.style("fill-opacity",0).attrs(a.interactorLayout),e.exit().remove(),t},nt.drawPercentBarComponents=function(t,e,a,i,r){t.style("stroke",rt.ColorHelper.getThemeColor(r,nt.DefaultPercentBarStrokeColorName));var r=t.selectAll(nt.Selectors.percentBar.mainLine.selector).data(e),r=(r.exit().remove(),r.enter().append("line").classed(nt.Selectors.percentBar.mainLine.class,!0).merge(r).attrs(a.percentBarLayout.mainLine),t.selectAll(nt.Selectors.percentBar.leftTick.selector).data(e)),r=(r.exit().remove(),r.enter().append("line").classed(nt.Selectors.percentBar.leftTick.class,!0).merge(r).attrs(a.percentBarLayout.leftTick),t.selectAll(nt.Selectors.percentBar.rightTick.selector).data(e)),r=(r.exit().remove(),r.enter().append("line").classed(nt.Selectors.percentBar.rightTick.class,!0).merge(r).attrs(a.percentBarLayout.rightTick),t.selectAll(nt.Selectors.percentBar.text.selector).data(e)),n=rt.valueFormatter.getLocalizedString("Percentage1");r.exit().remove(),r.enter().append("text").classed(nt.Selectors.percentBar.text.class,!0).merge(r).attrs(a.percentBarLayout.text.attr).styles(a.percentBarLayout.text.style).text(function(t){return rt.DataLabelViewModel.getLabelTailoredText({label:t.percent,format:n,fontProperties:i.fontProperties,maxWidth:a.percentBarLayout.text.maxWidth})}).append("title").text(function(t){return it.formattingService.formatValue(t.percent,n)})},nt.drawPercentBars=function(t,e,a,i,r){var n;i||!t.dataPoints||t.categoryCount<2||(i=[t.dataPoints[t.hasHighlights?1:0],t.dataPoints[t.dataPoints.length-1]],(n=nt.getValueFromDataPoint(i[0]))<=0)?nt.drawPercentBarComponents(e,[],a,t.percentBarLabelSettings,r):(i=[{value:nt.getValueFromDataPoint(i[0]),percent:1,isTop:!0},{value:nt.getValueFromDataPoint(i[1]),percent:nt.getValueFromDataPoint(i[1])/n,isTop:!1}],nt.drawPercentBarComponents(e,i,a,t.percentBarLabelSettings,r))},nt.prototype.showCategoryLabels=function(){return!(this.funnelSmallViewPortProperties&&this.funnelSmallViewPortProperties.hideFunnelCategoryLabelsOnSmallViewPort&&this.currentViewport.height<this.funnelSmallViewPortProperties.minHeightFunnelCategoryLabelsVisible)&&this.data&&this.data.categoryAxisSettings&&this.data.categoryAxisSettings.show},nt.addFunnelPercentsToTooltip=function(t,e,a,i,r,n){null!=i&&e.push({displayName:a.getLocalizedString("Funnel_PercentOfFirst"+(n?"_Highlight":"")),value:rt.valueFormatter.format(i,t)}),null!=r&&e.push({displayName:a.getLocalizedString("Funnel_PercentOfPrevious"+(n?"_Highlight":"")),value:rt.valueFormatter.format(r,t)})},nt.getDefaultLabelSettings=function(t){t=rt.DataLabelViewModel.getDefaultLabelSettings({style:t,textClassName:"lightLabel",noColor:!0}).fontProperties;return{show:!0,position:it.visuals.labelPosition.insideCenter,displayUnits:0,fontProperties:t,labelStyle:rt.funnelLabelStyle.data,percentagePrecision:rt.DataLabelViewModel.defaultPercentageLabelPrecision,bold:!1,italic:!1,underline:!1}},nt.getDefaultPercentLabelSettings=function(t){return{show:!0,position:0,displayUnits:0,fontProperties:rt.DataLabelViewModel.getDefaultLabelSettings({labelColor:rt.ColorHelper.getThemeColor(t,rt.DataLabelViewModel.DefaultLabelColorName),style:t,textClassName:"lightLabel"}).fontProperties,bold:!1,italic:!1,underline:!1}},nt.getDefaultCategoryLabelSettings=function(t){return{show:!0,fontProperties:rt.DataLabelViewModel.getDefaultLabelSettings({labelColor:rt.ColorHelper.getThemeColor(t,rt.DataLabelViewModel.DefaultLabelColorName),style:t,textClassName:"lightLabel"}).fontProperties,bold:!1,italic:!1,underline:!1}},nt.prototype.getLabels=function(t,e){var a,i=[];return this.data.dataLabelsSettings.show&&this.data.canShowDataLabels&&(t=this.createLabelDataPoints(t.shapeLayout,this.data.dataLabelsSettings),a=new it.LabelLayout({maximumOffset:rt.DataLabelViewModel.maxLabelOffset,startingOffset:rt.DataLabelViewModel.startingLabelOffset}),t={labelDataPoints:t,maxNumberOfLabels:t.length},e={width:this.currentViewport.width-e.left,height:this.currentViewport.height-e.top},i=a.layout([t],e)),i},nt.prototype.createLabelDataPoints=function(t,e){var a=this.data,i=a.dataPoints;if(_.isEmpty(i))return[];for(var r,n=new Array,o=i[0],l=nt.LabelInsidePosition,s=t.height(o),c=(e.position&&e.position===rt.labelPosition.outsideEnd&&(l=nt.LabelOutsidePosition),null),u=(0===e.displayUnits&&(c=a.dataPoints.reduce(function(t,e){return Math.abs(t.value)>Math.abs(e.value)?t:e}).value),rt.valueFormatter.getFormatString(a.valuesMetadata[0],rt.funnelChartProps.general.formatString)),h=rt.DataLabelViewModel.createColumnFormatterCacheManager(),g=a.dataLabelsSettings,d=g.labelStyle,p=g.fontProperties,f=(_.isEmpty(p)&&(p=rt.DataLabelViewModel.DefaultFontProperties),rt.FontProperties.toTextProperties(p)),m=rt.valueFormatter.getLocalizedString("Percentage"),y=rt.DataLabelViewModel.createColumnFormatterCacheManager(),g=_.clone(g),b=g.percentagePrecision,v=(g.displayUnits=0,_.isFinite(b)&&(r=y.getOrCreate(m,g,null,g.percentagePrecision)),rt.ColorHelper.getThemeColor(this.style,rt.DataLabelViewModel.DefaultLabelColorName)),S=rt.ColorHelper.getThemeColor(this.style,rt.DataLabelViewModel.DefaultInsideLabelColorName),L=!0,C=0,P=i;C<P.length;C++){var x=P[C],w=nt.getValueFromDataPoint(x,!0),F=nt.getFormatStringFromDataPoint(x);if(null!=w&&(!a.hasHighlights||x.highlight)){var F=F||u||o.labelFormatString,V=h.getOrCreate(F,e,c).format(w),D=void 0;if(L)D=V,L=!1;else{var B=r?r.format(x.percentOfFirst):rt.valueFormatter.format(x.percentOfFirst,m),T=r?r.format(x.percentOfPrevious):rt.valueFormatter.format(x.percentOfPrevious,m);switch(d){case rt.funnelLabelStyle.percentOfFirst:D=B;break;case rt.funnelLabelStyle.percentOfPrevious:D=T;break;case rt.funnelLabelStyle.dataAndPercentOfFirst:D=V+" ("+B+")";break;case rt.funnelLabelStyle.dataAndPercentOfPrevious:D=V+" ("+T+")";break;default:rt.funnelLabelStyle.data;D=V}}F={isPreferred:!0,text:f.text=D,textSize:{width:it.TextMeasurementService.measureSvgTextWidth(f),height:it.TextMeasurementService.estimateSvgTextHeight(f)},fontProperties:p,parentType:1,parentShape:{rect:{left:t.x(x),top:t.y(x),width:t.width(x),height:t.height(x)},orientation:nt.LabelOrientation,validPositions:l},insideFill:null!=(F=x.labelFill)?F:S,outsideFill:null!=(w=x.labelFill)?w:v,identity:x.identity,hasBackground:!1};0===x.value&&(w={validPositions:[256],point:{x:t.x(x),y:t.y(x)+s/2}},F.parentShape=w,F.parentType=0,F.insideFill=F.outsideFill),n.push(F)}}return n},nt.LabelInsidePosition=[1,16],nt.LabelOutsidePosition=[16,4],nt.LabelOrientation=3,nt.DefaultPercentBarStrokeColorName="foregroundNeutralTertiary",nt.DefaultBarOpacity=1,nt.DimmedBarOpacity=.4,nt.PercentBarToBarRatio=.75,nt.TickPadding=0,nt.InnerTickSize=0,nt.MinimumInteractorSize=15,nt.InnerTextClassName="labelSeries",nt.Selectors={funnel:{bars:t("funnelBar"),highlights:t("highlight"),interactors:t("funnelBarInteractor")},percentBar:{root:t("percentBars"),mainLine:t("mainLine"),leftTick:t("leftTick"),rightTick:t("rightTick"),text:t("value")}},nt.FunnelBarHighlightClass=[nt.Selectors.funnel.bars.class,nt.Selectors.funnel.highlights.class].join(" "),nt.YAxisPadding=10,nt.VisualClassName="funnelChart",nt.BarToSpaceRatio=.1,nt.MaxBarHeight=60,nt.MinBarThickness=12,nt.LabelFunnelPadding=6,nt.OverflowingHighlightWidthRatio=.5,nt.MaxMarginFactor=.25,nt.DefaultMargin={left:5,right:5,top:0,bottom:0},rt.FunnelChart=nt}(powerbi=powerbi||{}),function(h){var g,e;function t(t){return e.call(this,t)||this}g=h.visuals||(h.visuals={}),e=g.BaseAnimator,__extends(t,e),t.prototype.animate=function(t){var e={failed:!0,shapes:null,dataLabels:null},a=t.viewModel,i=this.previousViewModel;return i&&(a.hasHighlights&&!i.hasHighlights?e=this.animateNormalToHighlighted(t):a.hasHighlights&&i.hasHighlights?e=this.animateHighlightedToHighlighted(t):!a.hasHighlights&&i.hasHighlights&&(e=this.animateHighlightedToNormal(t))),this.previousViewModel=a,e},t.prototype.animateNormalToHighlighted=function(t){var e=t.viewModel,a=t.layout,i=t.interactivityService&&t.interactivityService.hasSelection(),e=(g.FunnelChart.drawDefaultAxis(t.axisGraphicsContext,t.axisOptions,t.isHidingPercentBars),t.shapeGraphicsContext.selectAll(g.FunnelChart.Selectors.funnel.bars.selector).data(e.dataPoints,function(t){return t.key})),r=e.enter().append("rect").attr("class",function(t){return t.highlight?g.FunnelChart.FunnelBarHighlightClass:g.FunnelChart.Selectors.funnel.bars.class}).attrs(a.shapeLayoutWithoutHighlights).merge(e),a=(r.style("fill",function(t){return t.color}).style("fill-opacity",function(t){return g.ColumnUtil.getFillOpacity(t.selected,t.highlight,i,!0)}).style("stroke-opacity",function(t){return g.ColumnUtil.getFillOpacity(t.selected,t.highlight,i,!0)}).transition().duration(this.animationDuration).attrs(a.shapeLayout),e.exit().remove(),this.animatePercentBars(t),g.DataLabelRenderer.animateDefaultLabels(t.labelGraphicsContext,t.labelLayout,this.animationDuration));return g.SVGUtil.flushAllD3TransitionsIfNeeded(t.visualInitOptions,r),{failed:!1,shapes:r,dataLabels:a}},t.prototype.animateHighlightedToHighlighted=function(t){g.FunnelChart.drawDefaultAxis(t.axisGraphicsContext,t.axisOptions,t.isHidingPercentBars);var e=this.animateDefaultShapes(t);return this.animatePercentBars(t),{failed:!1,shapes:e,dataLabels:g.DataLabelRenderer.animateDefaultLabels(t.labelGraphicsContext,t.labelLayout,this.animationDuration)}},t.prototype.animateHighlightedToNormal=function(t){var e=t.viewModel,a=t.layout,i=!!t.interactivityService&&t.interactivityService.hasSelection(),e=(g.FunnelChart.drawDefaultAxis(t.axisGraphicsContext,t.axisOptions,t.isHidingPercentBars),t.shapeGraphicsContext.selectAll(g.FunnelChart.Selectors.funnel.bars.selector).data(e.dataPoints,function(t){return t.key})),r=e.enter().append("rect").attr("class",function(t){return t.highlight?g.FunnelChart.FunnelBarHighlightClass:g.FunnelChart.Selectors.funnel.bars.class}).merge(e),a=(r.style("fill",function(t){return t.color}).style("fill-opacity",function(t){return g.ColumnUtil.getFillOpacity(t.selected,t.highlight,i,!t.selected)}).style("stroke-opacity",function(t){return g.ColumnUtil.getFillOpacity(t.selected,t.highlight,i,!t.selected)}).transition().duration(this.animationDuration).attrs(a.shapeLayoutWithoutHighlights).transition().duration(0).delay(0).style("fill-opacity",function(t){return g.ColumnUtil.getFillOpacity(t.selected,t.highlight,i,!1)}).style("stroke-opacity",function(t){return g.ColumnUtil.getFillOpacity(t.selected,t.highlight,i,!1)}),e.exit().transition().duration(this.animationDuration).attrs(i?a.zeroShapeLayout:a.shapeLayoutWithoutHighlights).remove(),this.animatePercentBars(t),g.DataLabelRenderer.animateDefaultLabels(t.labelGraphicsContext,t.labelLayout,this.animationDuration));return g.SVGUtil.flushAllD3TransitionsIfNeeded(t.visualInitOptions,r,e.exit()),{failed:!1,shapes:r,dataLabels:a}},t.prototype.animateDefaultShapes=function(t){var e=t.viewModel,a=e.dataPoints,i=t.layout,r=e.hasHighlights,n=!!t.interactivityService&&t.interactivityService.hasSelection(),e=t.shapeGraphicsContext.selectAll(g.FunnelChart.Selectors.funnel.bars.selector).data(a,function(t){return t.key}),a=e.enter().append("rect").attr("class",function(t){return t.highlight?g.FunnelChart.FunnelBarHighlightClass:g.FunnelChart.Selectors.funnel.bars.class}).merge(e);return a.style("fill",function(t){return t.color}).style("fill-opacity",function(t){return g.ColumnUtil.getFillOpacity(t.selected,t.highlight,n,r)}).style("stroke-opacity",function(t){return g.ColumnUtil.getFillOpacity(t.selected,t.highlight,n,r)}).transition().duration(this.animationDuration).attrs(i.shapeLayout),e.exit().remove(),g.SVGUtil.flushAllD3TransitionsIfNeeded(t.visualInitOptions,a),a},t.prototype.animatePercentBars=function(t){var a,e=t.viewModel;t.isHidingPercentBars||!e.dataPoints||(e.hasHighlights?e.dataPoints.length/2:e.dataPoints.length)<2||(e=[e.dataPoints[e.hasHighlights?1:0],e.dataPoints[e.dataPoints.length-1]],(a=g.FunnelChart.getValueFromDataPoint(e[0]))<=0)?this.animatePercentBarComponents([],t):(e=e.map(function(t,e){return{value:g.FunnelChart.getValueFromDataPoint(t),percent:0===e?1:g.FunnelChart.getValueFromDataPoint(t)/a,isTop:0===e}}),this.animatePercentBarComponents(e,t))},t.prototype.animateToFunnelPercent=function(t,e,a){return t.data(e).transition().duration(this.animationDuration).attrs(a)},t.prototype.animatePercentBarComponents=function(t,e){var a=e.percentGraphicsContext,i=e.layout,r=[{percent:0,value:0,isTop:!0},{percent:0,value:0,isTop:!1}],n=a.selectAll(g.FunnelChart.Selectors.percentBar.mainLine.selector).data(t),o=(this.animateToFunnelPercent(n.exit(),r,i.percentBarLayout.mainLine).remove(),n.enter().append("line").classed(g.FunnelChart.Selectors.percentBar.mainLine.class,!0).data(r).attrs(i.percentBarLayout.mainLine).merge(n)),l=(this.animateToFunnelPercent(o,t,i.percentBarLayout.mainLine),a.selectAll(g.FunnelChart.Selectors.percentBar.leftTick.selector).data(t)),s=(this.animateToFunnelPercent(l.exit(),r,i.percentBarLayout.leftTick).remove(),l.enter().append("line").classed(g.FunnelChart.Selectors.percentBar.leftTick.class,!0).data(r).attrs(i.percentBarLayout.leftTick).merge(l)),c=(this.animateToFunnelPercent(s,t,i.percentBarLayout.leftTick),a.selectAll(g.FunnelChart.Selectors.percentBar.rightTick.selector).data(t)),u=(this.animateToFunnelPercent(c.exit(),r,i.percentBarLayout.rightTick).remove(),c.enter().append("line").classed(g.FunnelChart.Selectors.percentBar.rightTick.class,!0).data(r).attrs(i.percentBarLayout.rightTick).merge(c)),a=(this.animateToFunnelPercent(u,t,i.percentBarLayout.rightTick),a.selectAll(g.FunnelChart.Selectors.percentBar.text.selector).data(t)),r=(this.animateToFunnelPercent(a.exit(),r,i.percentBarLayout.text.attr).remove(),a.enter().append("text").classed(g.FunnelChart.Selectors.percentBar.text.class,!0).data(r).attrs(i.percentBarLayout.text.attr).styles(i.percentBarLayout.text.style).merge(a));this.animateToFunnelPercent(r,t,i.percentBarLayout.text.attr).text(function(t){return h.formattingService.formatValue(t.percent,g.valueFormatter.getLocalizedString("Percentage1"))}),g.SVGUtil.flushAllD3TransitionsIfNeeded(e.visualInitOptions,o,n.exit(),s,l.exit(),u,c.exit(),r)},g.WebFunnelAnimator=t}(powerbi=powerbi||{}),function(t){((t=t.powerbi||(t.powerbi={})).visuals||(t.visuals={})).importFunnelChartModule=function(){}}(es6=es6||{}),function(t){var e;(e=t.visuals||(t.visuals={})).initializeFunnelChartFactoryES6=function(){e.setCreateFunnelChart(function(e){return es6.powerbi.visuals.importFunnelChartModule().then(function(t){return new t.FunnelChart(e)})})}}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['funnelChartVisual.min.js'] || (this.parseTimeMarkers['funnelChartVisual.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
